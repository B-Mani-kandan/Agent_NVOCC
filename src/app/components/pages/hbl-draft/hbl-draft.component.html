<div class="esp-bar">
  <h6>HBL DRAFT</h6>
</div>

<app-dynamic-gridview
  *ngIf="importfirstGridVisible"
  [data]="gridData"
  [columns]="displayedColumns"
  [tabNameNew]="IMPGENRAL"
  [tabName]="hbl_tabName"
  (rowSelected)="HandleRowActionFirstGrid($event)"
  (searchClicked)="onSearch()"
>
</app-dynamic-gridview>
<app-dynamic-forms
  *ngIf="isTabPanelVisible"
  [formGroup]="hbl_CommonForm"
  [formFields]="hbl_CommonFields"
  [templateId]="'HBL_COMMON'"
  [isMandatoryField]="getMandatoryFields('HBL_COMMON')"
  [getAutocompleteOptions]="getAutocompleteOptions.bind(this)"
  (formSubmit)="saveForm($event)"
></app-dynamic-forms>
<app-tab-panel
  [tabs]="hbl_tabLabels"
  *ngIf="isTabPanelVisible"
  [tabContents]="tabContents"
  (tabChanged)="onTabChange($event)"
></app-tab-panel>
<p-toast></p-toast>
<ng-template #HBL_GENERAL>
  <app-dynamic-forms
    [formGroup]="hbl_GeneralForm"
    [formFields]="hbl_GeneralFields"
    [templateId]="'HBL_GENERAL'"
    [isMandatoryField]="getMandatoryFields('HBL_GENERAL')"
    [getAutocompleteOptions]="getAutocompleteOptions.bind(this)"
    (formSubmit)="saveForm($event)"
  ></app-dynamic-forms>
</ng-template>
<ng-template #HBL_CARGO>
  <app-dynamic-forms
    [formGroup]="hbl_CargoForm"
    [formFields]="hbl_CargoFields"
    [templateId]="'HBL_CARGO'"
    [isMandatoryField]="getMandatoryFields('HBL_CARGO')"
    [getAutocompleteOptions]="getAutocompleteOptions.bind(this)"
    (formSubmit)="saveForm($event)"
  ></app-dynamic-forms>
</ng-template>
<ng-template #HBL_FREIGHT>
  <app-dynamic-forms
    [formGroup]="hbl_FreightForm"
    [formFields]="hbl_FreightFields"
    [templateId]="'HBL_FREIGHT'"
    [isMandatoryField]="getMandatoryFields('HBL_FREIGHT')"
    [getAutocompleteOptions]="getAutocompleteOptions.bind(this)"
    (formSubmit)="saveForm($event)"
  ></app-dynamic-forms>
  <app-dynamic-grid-add-delete
    #gridFreight
    [fields]="HBL_FREIGHTGRID_FIELDS"
    [fetchMethod]="fetchGridAutocomplete"
    (deleteRow)="onDeleteRow($event)"
    [initialRows]="latestFreightGridData"
    (gridDataChange)="onFreightGridDataChange($event)"
  ></app-dynamic-grid-add-delete>
</ng-template>
<ng-template #HBL_ANNEXURE>
  <app-dynamic-grid-add-delete
    #gridAnnexure
    [fields]="HBL_ANNEXUREGRID_FIELDS"
    (deleteRow)="onDeleteRow($event)"
    [initialRows]="latestAnnexureGridData"
    (gridDataChange)="onAnnexureGridDataChange($event)"
  ></app-dynamic-grid-add-delete>
</ng-template>
<ng-template #HBL_CONTAINER>
  <app-dynamic-grid-add-delete
    #gridContainer
    [fields]="HBL_CONTAINERGRID_FIELDS"
    [fetchMethod]="fetchGridAutocomplete"
    (deleteRow)="onDeleteRow($event)"
    [initialRows]="latestContainerGridData"
    (gridDataChange)="onContainerGridDataChange($event)"
  ></app-dynamic-grid-add-delete>
</ng-template>

<ng-template #MAIL>
  <div class="container-fluid mt-4">
    <div class="row mb-3 align-items-end">
      <div class="col-md-4">
        <label for="mailOption" class="form-label fw-semibold"
          >Mail Option</label
        >
        <input
          id="mailOption"
          class="form-control"
          readonly="true"
          [(ngModel)]="selectedMailOption"
        />
      </div>

      <!-- Action Buttons -->
      <div class="col-md-8 d-flex justify-content-start gap-3">
        <button
          type="button"
          class="btn btn-primary btn-md px-4"
          (click)="onGenerateMail()"
        >
          <i class="ri-mail-line me-1"></i> Generate Mail
        </button>

        <button
          type="button"
          *ngIf="mailBody"
          class="btn btn-success btn-md px-4"
          (click)="onSendMail()"
        >
          <i class="ri-mail-send-line me-1"></i> Send Mail
        </button>
      </div>
    </div>

    <!-- Subject -->
    <div class="row mb-3">
      <div class="col-md-12">
        <label for="mailSubject" class="form-label fw-semibold">Subject</label>
        <textarea
          id="mailSubject"
          class="form-control subject-text"
          rows="1"
          [(ngModel)]="mailSubject"
        ></textarea>
      </div>
    </div>

    <!-- To / CC -->
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="toMail" class="form-label fw-semibold">To Mail</label>
        <textarea
          id="toMail"
          class="form-control"
          rows="1"
          [(ngModel)]="toMail"
        ></textarea>
      </div>
      <div class="col-md-6">
        <label for="ccMail" class="form-label fw-semibold">CC Mail</label>
        <textarea
          id="ccMail"
          class="form-control"
          rows="1"
          [(ngModel)]="ccMail"
        ></textarea>
      </div>
    </div>

    <!-- Mail Preview -->
    <div class="row mb-3" *ngIf="mailBody">
      <div class="col-md-12">
        <label class="form-label fw-semibold">Generated Mail Preview</label>
        <div class="border rounded p-3 bg-light" [innerHTML]="mailBody"></div>
      </div>
    </div>
  </div>
</ng-template>

<div
  class="container-fluid d-flex gap-2 col-12 ml-2 mt-4"
  *ngIf="isTabPanelVisible && isButtonVisible"
>
  <button
    type="submit"
    class="btn custom-btn btn-success mb-4"
    *ngIf="!isModifyVisible"
    (click)="onSave('Save')"
  >
    Save
  </button>
  <button
    type="submit"
    class="btn custom-btn btn-success mb-4"
    *ngIf="isModifyVisible"
    (click)="onSave('Modify')"
  >
    Modify
  </button>
  <button
    type="submit"
    class="btn custom-btn btn-primary mb-4"
    (click)="onSearch()"
  >
    Search
  </button>
  <button
    type="reset"
    class="btn custom-btn btn-danger mb-4"
    (click)="ClearAllForms()"
  >
    Clear
  </button>
</div>

<app-loader
  [isLoading]="isLoading"
  bdColor="rgba(0, 0, 0,0.7)"
  size="md"
></app-loader>
<app-dynamic-gridview
  *ngIf="isGridVisible"
  [data]="gridData"
  [columns]="displayedColumns"
  [tabName]="hbl_tabName"
  [actionMap]="currentActionMap"
  (rowSelected)="HandleRowAction($event)"
>
  >
</app-dynamic-gridview>
